

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="https://s4.ax1x.com/2021/12/22/TQjIaQ.png">
  <link rel="icon" href="https://s4.ax1x.com/2021/12/22/TQjIaQ.png">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="wty">
  <meta name="keywords" content="">
  
    <meta name="description" content="å·²ç»“æŸçš„å…¨éƒ¨æ¯”èµ›ä»£ç ï¼šGitHub - æµ·é€‰èµ›å…¨éƒ¨ä»£ç ï¼ŒGitHub - å­¦ä¹ æœŸå…¨éƒ¨ä»£ç  ä¸‹æ–‡ä¸»è¦ä»‹ç»äº†æœ¬æ¬¡æ¯”èµ›å¯¹æºç çš„å­¦ä¹ ï¼Œç”±äºæ˜¯ç¬¬ä¸€æ¬¡å‚èµ›ï¼Œå¯¹æ•´ä¸ªæ¡†æ¶æ¯”è¾ƒé™Œç”Ÿï¼Œæ‰€ä»¥ç®€å•ä»‹ç»ä¸‹æˆ‘é€šè¿‡å­¦ä¹ æºç å¯¹åˆ†å¸ƒå¼æ¡†æ¶é€»è¾‘çš„ç†è§£ï¼Œä»¥åŠå¦‚ä½•åœ¨æ­¤åŸºç¡€ä¸Šå®Œæˆä¸€ä¸ªPPOç®—æ³•ã€‚  é‡è¿”ç§˜å¢ƒ  è¯¥æ¯”èµ›æ’åç¬¬6ï¼ˆ1380.17åˆ†ï¼Œå°½ç®¡åœ¨è‡ªå·±æµ‹è¯•300å±€ä¸­å¹³å‡å¾—åˆ†ä¸º1383åˆ†ï¼‰ï¼Œç¬¬ä¸€å1381.83åˆ†ï¼Œå¤±è´¥çš„ä¸»è¦åŸå› æ˜¯30æ¬¡è¯„">
<meta property="og:type" content="article">
<meta property="og:title" content="2024å¼€æ‚Ÿæ™ºèƒ½ä½“æ¯”èµ›ï¼ˆæµ·é€‰èµ›ï¼‰">
<meta property="og:url" content="https://wty-yy.xyz/posts/33143/index.html">
<meta property="og:site_name" content="wty&#39;s blog">
<meta property="og:description" content="å·²ç»“æŸçš„å…¨éƒ¨æ¯”èµ›ä»£ç ï¼šGitHub - æµ·é€‰èµ›å…¨éƒ¨ä»£ç ï¼ŒGitHub - å­¦ä¹ æœŸå…¨éƒ¨ä»£ç  ä¸‹æ–‡ä¸»è¦ä»‹ç»äº†æœ¬æ¬¡æ¯”èµ›å¯¹æºç çš„å­¦ä¹ ï¼Œç”±äºæ˜¯ç¬¬ä¸€æ¬¡å‚èµ›ï¼Œå¯¹æ•´ä¸ªæ¡†æ¶æ¯”è¾ƒé™Œç”Ÿï¼Œæ‰€ä»¥ç®€å•ä»‹ç»ä¸‹æˆ‘é€šè¿‡å­¦ä¹ æºç å¯¹åˆ†å¸ƒå¼æ¡†æ¶é€»è¾‘çš„ç†è§£ï¼Œä»¥åŠå¦‚ä½•åœ¨æ­¤åŸºç¡€ä¸Šå®Œæˆä¸€ä¸ªPPOç®—æ³•ã€‚  é‡è¿”ç§˜å¢ƒ  è¯¥æ¯”èµ›æ’åç¬¬6ï¼ˆ1380.17åˆ†ï¼Œå°½ç®¡åœ¨è‡ªå·±æµ‹è¯•300å±€ä¸­å¹³å‡å¾—åˆ†ä¸º1383åˆ†ï¼‰ï¼Œç¬¬ä¸€å1381.83åˆ†ï¼Œå¤±è´¥çš„ä¸»è¦åŸå› æ˜¯30æ¬¡è¯„">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://wty-yy.xyz/figures/competitions/kaiwu/result4.png">
<meta property="og:image" content="https://wty-yy.xyz/figures/competitions/kaiwu/result1.png">
<meta property="og:image" content="https://wty-yy.xyz/figures/competitions/kaiwu/result3.png">
<meta property="og:image" content="https://wty-yy.xyz/figures/competitions/kaiwu/result2.png">
<meta property="og:image" content="https://wty-yy.xyz/figures/competitions/kaiwu/bad1.png">
<meta property="og:image" content="https://wty-yy.xyz/figures/competitions/kaiwu/kaiwu_workframe.png">
<meta property="og:image" content="https://wty-yy.xyz/figures/competitions/kaiwu/tb1.png">
<meta property="article:published_time" content="2024-09-03T03:36:19.000Z">
<meta property="article:modified_time" content="2025-08-08T07:06:24.225Z">
<meta property="article:author" content="wty">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://wty-yy.xyz/figures/competitions/kaiwu/result4.png">
  
  
  
  <title>2024å¼€æ‚Ÿæ™ºèƒ½ä½“æ¯”èµ›ï¼ˆæµ·é€‰èµ›ï¼‰ - wty&#39;s blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/prism/1.26.0/plugins/line-numbers/prism-line-numbers.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/KaTeX/0.15.2/katex.min.css" />



<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  



  
<link rel="stylesheet" href="/css/fold_code.css">
<link rel="stylesheet" href="//at.alicdn.com/t/font_3429772_kq6ntj4nzdo.css">
<link rel="stylesheet" href="//fastly.jsdelivr.net/gh/bynotes/texiao/source/css/toubudaziji.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"wty-yy.xyz","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":"843a38ffdc8864dd30e250b723a1a8ca","google":null,"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null},"gtag":null,"woyaola":null,"cnzz":null},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/katex@0.11.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Home</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>é¦–é¡µ</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>å½’æ¡£</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>åˆ†ç±»</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>æ ‡ç­¾</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>å…³äº</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>å‹é“¾</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button"
                 data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="iconfont icon-books"></i>
                <span>æ–‡æ¡£</span>
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                  
                  
                  
                  <a class="dropdown-item" href="/posts/020109/" target="_self">
                    
                    <span>æ‚è®°</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/posts/18857/" target="_self">
                    
                    <span>æ¨¡æ¿&dotfiles</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/posts/64648/" target="_self">
                    
                    <span>å¸¸ç”¨å‘½ä»¤åŠå‡½æ•°</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/posts/57899/" target="_self">
                    
                    <span>ç®—æ³•æ€»ç»“</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/posts/20023/" target="_self">
                    
                    <span>Linuxæ‚è®°</span>
                  </a>
                
              </div>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://s4.ax1x.com/2021/12/22/TQOxyT.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="2024å¼€æ‚Ÿæ™ºèƒ½ä½“æ¯”èµ›ï¼ˆæµ·é€‰èµ›ï¼‰"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-09-03 11:36" pubdate>
          2024å¹´9æœˆ3æ—¥ ä¸­åˆ
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          3.7k å­—
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          31 åˆ†é’Ÿ
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">2024å¼€æ‚Ÿæ™ºèƒ½ä½“æ¯”èµ›ï¼ˆæµ·é€‰èµ›ï¼‰</h1>
            
              <p id="updated-time" class="note note-info" style="">
                
                  
                    <!-- compatible with older versions-->
                    æœ€æ–°æ›´æ–°äº: 2025å¹´8æœˆ8æ—¥ä¸‹åˆ3ç‚¹06åˆ†
                  
                
              </p>
            
            
              <div class="markdown-body">
                
                <p><strong>å·²ç»“æŸçš„å…¨éƒ¨æ¯”èµ›ä»£ç </strong>ï¼š<a target="_blank" rel="noopener" href="https://github.com/wty-yy/kaiwu2024_taichu/tree/master/secret_realm/code">GitHub - æµ·é€‰èµ›å…¨éƒ¨ä»£ç </a>ï¼Œ<a target="_blank" rel="noopener" href="https://github.com/wty-yy/kaiwu2024_taichu/tree/master/gorgewalk/code">GitHub - å­¦ä¹ æœŸå…¨éƒ¨ä»£ç </a></p>
<p>ä¸‹æ–‡ä¸»è¦ä»‹ç»äº†æœ¬æ¬¡æ¯”èµ›å¯¹æºç çš„å­¦ä¹ ï¼Œç”±äºæ˜¯ç¬¬ä¸€æ¬¡å‚èµ›ï¼Œå¯¹æ•´ä¸ªæ¡†æ¶æ¯”è¾ƒé™Œç”Ÿï¼Œæ‰€ä»¥ç®€å•ä»‹ç»ä¸‹æˆ‘é€šè¿‡å­¦ä¹ æºç å¯¹åˆ†å¸ƒå¼æ¡†æ¶é€»è¾‘çš„ç†è§£ï¼Œä»¥åŠå¦‚ä½•åœ¨æ­¤åŸºç¡€ä¸Šå®Œæˆä¸€ä¸ªPPOç®—æ³•ã€‚</p>
<h2 id="é‡è¿”ç§˜å¢ƒ"><a class="markdownIt-Anchor" href="#é‡è¿”ç§˜å¢ƒ"></a> é‡è¿”ç§˜å¢ƒ</h2>
<blockquote>
<p>è¯¥æ¯”èµ›æ’åç¬¬6ï¼ˆ1380.17åˆ†ï¼Œå°½ç®¡åœ¨è‡ªå·±æµ‹è¯•300å±€ä¸­å¹³å‡å¾—åˆ†ä¸º1383åˆ†ï¼‰ï¼Œç¬¬ä¸€å1381.83åˆ†ï¼Œå¤±è´¥çš„ä¸»è¦åŸå› æ˜¯30æ¬¡è¯„æµ‹ä¸­ï¼ˆæ€»å…±9ä¸ªéšæœºå®ç®±ï¼‰ï¼Œå…¶ä¸­æœ‰ä¸€æ¬¡è¯„æµ‹ä¸­åªæ¡äº†8ä¸ªï¼Œå¦åˆ™å¯ä»¥è¶…è¿‡ç¬¬ä¸€å1åˆ†ä»¥ä¸Šï¼Œåªèƒ½è¯´æ™ºèƒ½ä½“è¿˜æ˜¯ä¸å¤Ÿç¨³å®šï¼Œæµ‹è¯•æ–¹æ³•ä¸å¤Ÿå¥½ï¼ˆæ€»å…±ä¹Ÿå°±715ç§å®ç®±åˆ†å¸ƒæƒ…å†µï¼Œæ²¡æœ‰å…¨éƒ¨è€ƒè™‘åˆ°ï¼‰ï¼Œå¥–åŠ±è®¾è®¡è¿˜æ˜¯é—®é¢˜ï¼Œå®ç®±é—æ¼çš„è´Ÿæƒ©ç½šä»ç„¶ä¸å¤Ÿå¤§ã€‚</p>
</blockquote>
<p>PPOç®—æ³•å¯ä»¥åœ¨ä¸Šè¿°æºç ä¸­<a target="_blank" rel="noopener" href="https://github.com/wty-yy/kaiwu2024_taichu/tree/master/secret_realm/code/diy">diyæ–‡ä»¶å¤¹</a>ä¸‹æ‰¾åˆ°ï¼Œv1.2çš„è®­ç»ƒæ€»æ—¶é•¿ä¸º33+20+31.5+12.5=97å°æ—¶ï¼ˆ8~12è¿›ç¨‹ï¼‰æ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè®­ç»ƒ12.5å°æ—¶å·²ç»èƒ½è¾¾åˆ°1350åˆ†äº†ã€‚</p>
<p><img src="/figures/competitions/kaiwu/result4.png" srcset="/img/loading.gif" lazyload alt="æµ·é€‰èµ›æœ€ç»ˆæˆç»©" /><br />
<img src="/figures/competitions/kaiwu/result1.png" srcset="/img/loading.gif" lazyload alt="è‡ªæµ‹v1.2.2éƒ¨åˆ†ç»“æœï¼ˆæ²¡ç”¨1.2.2å› ä¸ºå‡ºç°äº†5æ¬¡æµ‹è¯•ä¸­å‡ºç°äº†ä¸€æ¬¡1381çš„å‡åˆ†ï¼‰" /><br />
<img src="/figures/competitions/kaiwu/result3.png" srcset="/img/loading.gif" lazyload alt="è‡ªæµ‹v1.2éƒ¨åˆ†ç»“æœï¼ˆ5æ¬¡æµ‹è¯•å‡åœ¨1382å’Œ1383ï¼‰" /><br />
<img src="/figures/competitions/kaiwu/result2.png" srcset="/img/loading.gif" lazyload alt="æ¯”èµ›éƒ¨åˆ†å¯¹å±€ç»“æœ" /><br />
<img src="/figures/competitions/kaiwu/bad1.png" srcset="/img/loading.gif" lazyload alt="æœ€ç»ˆæ¯”èµ›æ—¶å‡ºç°çš„é”™è¯¯å¯»è·¯ç»“æœ" /></p>
<p>ä»£ç åŸºç¡€æ¡†æ¶å’Œå­¦ä¹ æœŸç›¸åŒï¼Œæœ¬æ¬¡éš¾ç‚¹åœ¨äºåˆ†å¸ƒå¼æ¡†æ¶çš„ä½¿ç”¨ï¼Œç”±äºæˆ‘ä¸å–œæ¬¢ç”¨DQNï¼Œåªèƒ½å°è¯•å†™PPO</p>
<h3 id="å‰ç½®èŠå£«"><a class="markdownIt-Anchor" href="#å‰ç½®èŠå£«"></a> å‰ç½®èŠå£«</h3>
<p>ä¸‹æ–‡ä¸­æ‰€æœ‰çš„é…ç½®å‚æ•°ï¼Œè‹¥æ— ç‰¹æ®Šè¯´æ˜ï¼Œé»˜è®¤åœ¨ <code>conf/configure_app.toml</code> ä¸­ï¼Œå¦‚æœæ²¡æœ‰å¯¹åº”å˜é‡åï¼Œåˆ™éœ€è¦è‡ªå·±åŠ å…¥ï¼ˆtomlè¯­æ³•å¯ä»¥<a target="_blank" rel="noopener" href="https://toml.io/cn">å‚è€ƒå®˜ç½‘</a>ï¼Œå¯ä»¥åœ¨vscodeä¸­å®‰è£…tomlæ’ä»¶è¿›è¡Œæ¸²æŸ“ï¼‰</p>
<p>è¿™é‡Œçš„æ™ºèƒ½ä½“ä»£ç æˆ‘ä»¬éƒ½å·² <code>diy</code> ä¸­çš„ä¸ºä¾‹ï¼Œä»£ç ç»“æ„å¦‚ä¸‹ï¼ˆå¿…è¦éƒ¨åˆ†ï¼‰ï¼š</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">â””â”€â”€ code
    â”œâ”€â”€ conf
    â”‚   â”‚ <span class="token comment"># è‡ªå®šä¹‰çš„é…ç½®æ–‡ä»¶ï¼Œä¹Ÿæ˜¯æœ€é«˜ä¼˜å…ˆçº§ï¼Œå¯ä»¥è¦†ç›–ä»–ä»¬çš„é»˜è®¤é…ç½®</span>
    â”‚   â””â”€â”€ configure_app.toml
    â””â”€â”€ diy
        â”œâ”€â”€ algorithm
        â”‚   â”‚ <span class="token comment"># æˆ‘ä»¬å®šä¹‰çš„æ™ºèƒ½ä½“Agentç±»ï¼Œå¿…é¡»æœ‰ä»–ä»¬è¦æ±‚çš„6ä¸ªå‡½æ•°</span>
        â”‚   â”‚ <span class="token comment"># __init__, predict, exploit, learn, save_model, load_model</span>
        â”‚   â””â”€â”€ agent.py
        â”œâ”€â”€ feature
        â”‚   â”‚ <span class="token comment"># å¯¹SampleData, ObsData, ActData,</span>
        â”‚   â”‚ <span class="token comment"># observation_process, action_process, sample_process, </span>
        â”‚   â”‚ <span class="token comment"># SampleData2NumpyData, NumpyData2SampleDataè¿›è¡Œå®šä¹‰ï¼Œ</span>
        â”‚   â”‚ <span class="token comment"># å®šä¹‰å¹¶è½¬æ¢å­˜å…¥bufferçš„æ•°æ®ç»“æ„</span>
        â”‚   â””â”€â”€ definition.py
        â”‚ <span class="token comment"># é…ç½®æ–‡ä»¶ï¼Œ</span>
        â”‚ <span class="token comment"># å¿…é¡»ä¿è¯Configç±»ä¸­çš„SAMPLE_DIM</span>
        â”‚ <span class="token comment"># å’ŒNumpyData2SampleDataå‡½æ•°æ•°æ®å¯¹é½ï¼Œå¦åˆ™å¯èƒ½æŠ¥æ ·æœ¬ç»´åº¦é”™è¯¯</span>
        â”œâ”€â”€ config.py
        â”‚ <span class="token comment"># æ¨¡å‹è®­ç»ƒæ—¶ä¼šè°ƒç”¨çš„è®­ç»ƒå·¥ä½œæµï¼Œç”¨äºæ ·æœ¬çš„é‡‡æ ·ä¸bufferå­˜å…¥</span>
        â””â”€â”€ train_workflow.py<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>
<p>å®ç°äº†è¿™äº›å†…å®¹åï¼Œæœ‰ä¸¤ç§<strong>å¯åŠ¨å•è¿›ç¨‹è®­ç»ƒ</strong>çš„æ–¹æ³•ï¼ˆç”¨äºè°ƒè¯•ï¼‰ï¼š</p>
<ol>
<li>å°† <code>train_test.py</code> ä¸­è®¾ç½®ä¸º <code>algorithm_name = &quot;diy&quot;</code> æ‰§è¡Œ <code>train_test.py</code> å°±å¯ä»¥è®­ç»ƒäº†ã€‚</li>
<li>å°† <code>configure_app.toml</code> ä¸­çš„å‚æ•°è®¾ç½®ä¸º <code>algo = &quot;diy&quot;</code>ï¼Œæ‰§è¡Œ <code>./tools/start.sh</code> å³å¯å¼€å§‹è®­ç»ƒã€‚</li>
</ol>
<p>æ‰§è¡Œ <code>./tools/stop.sh all</code> å¯ä»¥æ€æ­»æ‰€æœ‰è¿›ç¨‹ã€‚</p>
<h3 id="localremoteè®­ç»ƒé€»è¾‘"><a class="markdownIt-Anchor" href="#localremoteè®­ç»ƒé€»è¾‘"></a> local/remoteè®­ç»ƒé€»è¾‘</h3>
<p>ä¸¤ç§è®­ç»ƒæ¨¡å¼local/remoteï¼Œè¿™å…³ç³»åˆ°è¿›ç¨‹çš„åˆ›å»ºæ•°ç›®ï¼ˆæµ·é€‰èµ›å’Œå­¦ä¹ æœŸçš„ä¸åŒä¹‹å¤„ï¼‰ï¼Œä¹Ÿæ­£å¦‚å®˜æ–¹æ‰€è¯´çš„ï¼Œç¡®å®å¯ä»¥åšåˆ°äº†ä¸¤ç§æ¨¡å¼ä¸‹ï¼Œä»£ç éƒ½å¯ä»¥ç›´æ¥è¿è¡Œï¼Œæœ€å¤§åŒºåˆ«åœ¨äºlocalä¸å­˜åœ¨bufferï¼Œè€Œremoteä¼šåˆ›å»ºä¸€ä¸ªbufferå­˜å‚¨aisrväº§ç”Ÿçš„æ ·æœ¬ã€‚</p>
<blockquote>
<p>ä¸‹é¢çš„é€»è¾‘åˆ†æéƒ½æ˜¯é€šè¿‡æŸ¥çœ‹æºç è·å¾—ï¼Œåˆ†ææ–¹æ³•ä¸»è¦æ˜¯åŸºäºPythonä¸­çš„tracebackå‡½æ•°ï¼Œè‡ªå·±å†™äº†ä¸€ä¸ªæ‰“å°å›è°ƒä¿¡æ¯çš„å‡½æ•° <a target="_blank" rel="noopener" href="https://github.com/wty-yy/kaiwu2024/blob/master/secret_realm/code/diy/utils/__init__.py#L32"><code>show_debug</code></a>ï¼Œå¯¹æºç ä¸­çš„æ¯ä¸ªéƒ¨åˆ†åˆ†åˆ«åŠ å…¥è¯¥å‡½æ•°è¿›è¡Œè°ƒè¯•ã€‚é€»è¾‘åˆ†æçš„è¿‡ç¨‹è¯·è§<a target="_blank" rel="noopener" href="https://github.com/wty-yy/kaiwu2024_taichu/blob/master/assets/code_logic.md#%E5%88%86%E5%B8%83%E5%BC%8F%E5%BC%80%E5%8F%91">code_logic.md</a>ï¼Œé‡Œé¢æœ‰æ›´è¯¦ç»†çš„è°ƒç”¨å…³ç³»ï¼Œä»¥ä¸‹å†…å®¹ä¸ºç²¾ç®€ç‰ˆã€‚</p>
</blockquote>
<p>ç”¨drawioç®€å•ç”»äº†ä¸ªç¤ºæ„å›¾ï¼ˆç”»çš„æŒºçƒ‚çš„ğŸ˜Ÿï¼‰ï¼Œå¯¹æ¯ä¸ªéƒ¨åˆ†çš„è¯¦ç»†ä»‹ç»è¯·è§ä¸‹æ–‡<br />
<img src="/figures/competitions/kaiwu/kaiwu_workframe.png" srcset="/img/loading.gif" lazyload alt="å¼€æ‚Ÿåˆ†å¸ƒå¼æ¶æ„ï¼ˆæç®€ç‰ˆï¼‰" /></p>
<p><strong>local/remoteè®­ç»ƒæ¨¡å¼</strong>ï¼šé…ç½®å‚æ•° <code>wrapper_type</code> å³å¯å¯¹å…¶è¿›è¡Œä¿®æ”¹ï¼Œæœ‰ä¸¤ä¸ªé…ç½®ï¼š</p>
<ul>
<li><code>&quot;local&quot;</code>ï¼šä¹Ÿå°±æ˜¯å­¦ä¹ æœŸçš„æœ¬åœ°è®­ç»ƒï¼Œè¯¥æ¨¡å¼ä¸‹ï¼Œç³»ç»Ÿä¸ä¼šå¯¹ä½ çš„ <code>Agent</code> è¿›è¡ŒåŒ…è£…ï¼Œä»…åŒ…å«<strong>ä¸€ä¸ªè®­ç»ƒè¿›ç¨‹aisrv</strong>ï¼Œä¹Ÿå°±æ˜¯RLæœ€ç®€å•çš„è®­ç»ƒæ¨¡å¼ï¼Œåˆå§‹åŒ–ç¯å¢ƒã€æ™ºèƒ½ä½“ã€bufferï¼Œé€šè¿‡æ™ºèƒ½ä½“ä¸ç¯å¢ƒäº¤äº’è·å¾—æ ·æœ¬å­˜å‚¨åœ¨bufferä¸­ï¼Œè®­ç»ƒæ—¶ä»ä¸­è¿›è¡Œé‡‡æ ·ï¼Œæ›´æ–°valueå’Œpolicyç½‘ç»œã€‚</li>
<li><code>&quot;remote&quot;</code>ï¼šä¹Ÿå°±æ˜¯æµ·é€‰èµ›çš„å¤šè¿›ç¨‹è®­ç»ƒæ¨¡å¼ï¼Œè¯¥æ¨¡å¼ä¸‹ï¼Œç³»ç»Ÿä¼šåˆ›å»ºå¦‚ä¸‹å‡ ä¸ªè¿›ç¨‹ï¼š
<ul>
<li>learnerï¼š
<ul>
<li>åŠŸèƒ½ï¼šç”¨äºå¤„ç†bufferä¸­é‡‡æ ·çš„æ ·æœ¬ï¼Œæ›´æ–°valueå’Œpolicyç½‘ç»œï¼Œä¿å­˜ç½‘ç»œå‚æ•°ã€‚</li>
<li>ä»‹ç»ï¼šåŒ…å«ä¸€ä¸ªå®ä¾‹åŒ–çš„ <code>agent</code>ã€‚è¯¥è¿›ç¨‹åªä¼šè°ƒç”¨ <code>agent.learn</code> å‡½æ•°ï¼Œ<strong>ä¸”è°ƒç”¨è¯¥å‡½æ•°ä¸å—æˆ‘ä»¬å†™çš„ä»£ç æ§åˆ¶</strong>ï¼Œä»…æ ¹æ®é…ç½®ä¸­çš„bufferé€»è¾‘è¿›è¡Œåå°è¿›è¡Œè‡ªåŠ¨è°ƒç”¨ï¼Œå‚è€ƒä¸‹æ–‡ä¸­bufferçš„ä»‹ç»ã€‚</li>
<li>æ³¨æ„ï¼šåœ¨ <code>learn</code> ä¸­è°ƒç”¨ <code>save_model</code> å‡½æ•°åªä¼šå°†æ¨¡å‹ä¿å­˜åˆ°æœ¬æœºã€‚</li>
</ul>
</li>
<li>actorï¼š
<ul>
<li>åŠŸèƒ½ï¼šåŸºäºçŠ¶æ€è¿›è¡Œæ¢ç´¢åŠ¨ä½œçš„é¢„æµ‹ï¼Œå¹¶ä¼šè‡ªåŠ¨ä» <code>model_pool</code> ä¸­æ›´æ–°æ¨¡å‹å‚æ•°ã€‚</li>
<li>ä»‹ç»ï¼šåŒ…å«ä¸€ä¸ªå®ä¾‹åŒ–çš„ <code>agent</code>ã€‚è¯¥è¿›ç¨‹åªä¼šè°ƒç”¨ <code>agent.predict, load_model</code>ï¼Œè¿™ä¸ªå‡½æ•°è¾“å…¥çš„çŠ¶æ€ä¿¡æ¯æ˜¯ç”± <code>aisrv</code> é€šè¿‡tcpå‘é€åˆ°è¯¥è¿›ç¨‹çš„ï¼ˆå¦‚æœæ¯ä¸ªç¯å¢ƒéƒ½å•å¼€ä¸€ä¸ªéå¸¸å®¹æ˜“å¯¼è‡´æ˜¾å­˜çˆ†ç‚¸ï¼Œå¹¶ä¸”åˆ†å¸ƒå¼ä¸‹ä¹Ÿä¸ä¸€å®šæ‰€æœ‰æœåŠ¡å™¨éƒ½æœ‰æ˜¾å¡ï¼‰ï¼Œå› æ­¤æ‰€æœ‰çš„ <code>aisrv</code> éƒ½å…±äº«çš„æ˜¯ä¸€ä¸ªç›¸åŒçš„ <code>agent</code> å®ä¾‹ï¼Œè¯¥ <code>agent</code> çš„æƒé‡æ›´æ–°ä¼šç”¨åˆ° <code>model_pool</code>ï¼Œæ­¤é€»è¾‘ä¼šåœ¨ä¸‹æ–‡è¿›è¡Œä»‹ç»ã€‚</li>
</ul>
</li>
<li>aisrvï¼š
<ul>
<li>åŠŸèƒ½ï¼šä½¿ç”¨ <code>actor</code> ä¸­çš„ <code>agent</code> ä¸ä¸€ä¸ªç‹¬ç«‹çš„ç¯å¢ƒè¿›è¡Œäº¤äº’ï¼Œäº§ç”Ÿæ ·æœ¬ä¿å­˜åˆ°bufferä¸­ã€‚</li>
<li>ä»‹ç»ï¼šåŒ…å«ä¸€ä¸ªå®ä¾‹åŒ–çš„ç¯å¢ƒ <code>env</code>ï¼Œ<strong>è¯¥è¿›ç¨‹ä¼šè°ƒç”¨ <code>train_workflow.workflow</code> å‡½æ•°</strong>ã€‚æ³¨æ„ä¼ å…¥çš„ <code>agent</code> ä¸æ˜¯ä½ å†™çš„ <code>Agent</code> ç±»å®ä¾‹åŒ–ç»“æœï¼Œè€Œæ˜¯ <code>actor</code> çš„ï¼Œè°ƒç”¨æ‰€æœ‰ <code>predict, load_model</code> å‡½æ•°éƒ½ä¼šé€šè¿‡tcpå’Œ <code>actor</code> è¿›è¡Œé€šè®¯ï¼Œè€Œ <code>learn</code> å‡½æ•°åˆ™ä¸ä¼šèµ·åˆ°ä½œç”¨ï¼ˆç”±åå°æ ¹æ®é‡‡æ ·é€»è¾‘è¿›è¡Œé‡‡æ ·å¹¶å‘é€learnerè®­ç»ƒï¼‰ï¼Œå‘é€æ ·æœ¬åˆ°bufferçš„å‡½æ•°åˆ™æ˜¯ <code>learn</code>ã€‚</li>
</ul>
</li>
<li>bufferï¼š
<ul>
<li>åŠŸèƒ½ï¼šå­˜å‚¨aisrvé€šè¿‡ <code>learn</code> å‘é€çš„æ ·æœ¬ï¼Œå¹¶åŸºäºé‡‡æ ·ç­–ç•¥è¿›è¡Œé‡‡æ ·ã€‚</li>
<li>ä»‹ç»ï¼šåŒ…å«ä¸€ä¸ªä» <code>reverb</code> åŒ…(Deepmind)ä¸­å®ä¾‹åŒ–çš„bufferã€‚å› æ­¤bufferçš„é‡‡æ ·å’Œç§»é™¤ç­–ç•¥å¯ä»¥<a target="_blank" rel="noopener" href="https://github.com/google-deepmind/reverb">å‚è€ƒå®˜æ–¹æ–‡æ¡£</a>ï¼Œå¸¸ç”¨çš„é‡‡æ ·ç­–ç•¥ä¸ºå‡åŒ€é‡‡æ · <code>Uniform</code>ï¼Œç§»é™¤ç­–ç•¥ä¸ºé¡ºåºç§»é™¤ï¼ˆå¯ä»¥æŠŠä»–æƒ³è±¡æˆä¸€ä¸ªé˜Ÿåˆ—ï¼ŒåŠ å…¥æ ·æœ¬å°±æ˜¯è¿›é˜Ÿå°¾ï¼Œé¡ºåºç§»é™¤å°±æ˜¯å¼¹å‡ºé˜Ÿé¦–ï¼‰ï¼Œè¿™ä¸ªé…ç½®ç›¸å…³å‚æ•°ä¸º <code>reverb_remover, reverb_sampler</code>ã€‚</li>
</ul>
</li>
<li>model_poolï¼š
<ul>
<li>åŠŸèƒ½ï¼šè‡ªåŠ¨åŒæ­¥learnerä¿å­˜çš„æ¨¡å‹ï¼ˆä¿å­˜é¢‘ç‡ä¸ºé…ç½®ä¸­çš„ <code>dump_model_freq</code>ï¼ŒåŒæ­¥æ—¶é—´ä¸º <code>model_file_sync_per_minutes</code>ï¼Œå•ä½åˆ†é’Ÿï¼‰ï¼Œå¤„ç†actoræˆ–aisrvé€šè¿‡ <code>load_model</code> è¿›è¡Œè¯»å–æ¨¡å‹çš„è¯·æ±‚ã€‚</li>
<li>ä»‹ç»ï¼šåŒæ­¥learnerä¿å­˜çš„æ¨¡å‹ä»…èƒ½ä»æ¡†æ¶åŸºäº <code>dump_model_freq</code> è‡ªåŠ¨ä¿å­˜çš„ä½ç½®è¿›è¡Œè¯»å–ï¼ˆä¿å­˜åˆ°ä¸Šå›¾å³ä¸Šè§’frameworkå­˜å‚¨ä½ç½®ï¼‰ï¼Œä¹Ÿæ— æ³•æ‰‹åŠ¨è¿›è¡ŒåŒæ­¥ï¼Œåªèƒ½é€šè¿‡é…ç½®æŒ‡å®šçš„åŒæ­¥æ—¶é—´ <code>model_file_sync_per_minutes</code> è‡ªåŠ¨è¿›è¡ŒåŒæ­¥ï¼ˆç”±äºä»–è¿˜è¿›è¡Œäº†å–æ•´å¤„ç†ï¼Œå› æ­¤æœ€å°åŒæ­¥æ—¶é—´ä¸º1åˆ†é’Ÿï¼‰ã€‚</li>
<li>æ³¨æ„ï¼šmodel_poolå’Œä¿å­˜åœ¨æœ¬æœº <code>train/backup_model</code> çš„æ¨¡å‹ä¸åŒï¼Œmodel_poolæ˜¯å­˜å‚¨åˆ°å®¹å™¨ä¸­çš„ï¼Œè€Œåè€…æ˜¯å­˜å‚¨åœ¨æœ¬æœºçš„æŒ‚è½½ç›®å½•ä¸‹ï¼ˆä¹Ÿå°±æ˜¯å®¿ä¸»æœºï¼‰ã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>åˆ†å¸ƒå¼çš„å¯åŠ¨æ–¹æ³•æˆ‘ä¼°è®¡æ˜¯å®¢æˆ·ç«¯å†™äº†docker composeé…ç½®æ–‡ä»¶ï¼Œé€šè¿‡composeåŠŸèƒ½åŒæ—¶å¼€äº†å¤šä¸ªå®¹å™¨ï¼ˆæ›´å¤šçš„envå’Œaisrvè¿›ç¨‹ï¼‰ä½¿ä»–ä»¬ä¹‹é—´ç”¨tcpé€šè®¯ï¼Œè¿˜æ²¡ç ”ç©¶è¿™å—å…·ä½“æ˜¯æ€ä¹ˆåšåˆ°çš„ã€‚ã€‚ã€‚</p>
</blockquote>
<h3 id="ppoçš„å…·ä½“å®ç°ç»†èŠ‚"><a class="markdownIt-Anchor" href="#ppoçš„å…·ä½“å®ç°ç»†èŠ‚"></a> PPOçš„å…·ä½“å®ç°ç»†èŠ‚</h3>
<blockquote>
<p>åœ¨GitHubä¸­ä¹Ÿè®°å½•äº†å½“åˆ<a target="_blank" rel="noopener" href="https://github.com/wty-yy/kaiwu2024_taichu/tree/master/secret_realm/code#distribution-ppo">å®ç°PPOæ³¨æ„çš„ç»†èŠ‚</a></p>
<p>è¿™é‡Œå¤§éƒ¨åˆ†æŠŠä¹‹å‰<a target="_blank" rel="noopener" href="https://aiarena.tencent.com/community/d/505-you-mei-you-yong-ppode-lao-jiao-liu-yi-xia/28">è®ºå›</a>å›å¤çš„å†…å®¹copyäº†ä¸€äº›ğŸ˜…</p>
</blockquote>
<p>ä¸»è¦å°±æ˜¯æŠŠgaeæ”¾åˆ°learnerä¸­ç®—(å¾—åˆ°returnå’Œadv), bufferä¸­æ¯ä¸ªæ ·æœ¬å­˜çš„æ˜¯ä¸€æ®µè½¨è¿¹, è€Œlogprobä½¿ç”¨çš„æ˜¯actoré‡‡æ ·æ—¶å€™çš„å€¼, bufferçš„ä¿®æ”¹ï¼Œè¯·è§ <a target="_blank" rel="noopener" href="https://github.com/wty-yy/kaiwu2024_taichu/blob/master/secret_realm/code/diy/feature/definition.py"><code>definition.py</code></a>ï¼š</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python">SampleData <span class="token operator">=</span> create_cls<span class="token punctuation">(</span><span class="token string">"SampleData"</span><span class="token punctuation">,</span> obs<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> actions<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
  rewards<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> dones<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> next_obs<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> next_done<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
  logprobs<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@attached</span>
<span class="token keyword">def</span> <span class="token function">NumpyData2SampleData</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># bufferä¸­å–å‡ºæ¥ä»¥åè½¬æ¢</span>
  n <span class="token operator">=</span> args<span class="token punctuation">.</span>num_steps  <span class="token comment"># æˆ‘è®¾çš„æ˜¯128, å°±æ˜¯å­˜å‚¨åˆ°bufferä¸­çš„ä¸€å°æ®µè½¨è¿¹é•¿åº¦</span>
  obs_dim <span class="token operator">=</span> args<span class="token punctuation">.</span>obs_dim
  <span class="token keyword">return</span> SampleData<span class="token punctuation">(</span>
    obs<span class="token operator">=</span>data<span class="token punctuation">[</span><span class="token punctuation">:</span>n<span class="token operator">*</span>obs_dim<span class="token punctuation">]</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    actions<span class="token operator">=</span>data<span class="token punctuation">[</span>n<span class="token operator">*</span>obs_dim<span class="token punctuation">:</span>n<span class="token operator">*</span><span class="token punctuation">(</span>obs_dim<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    rewards<span class="token operator">=</span>data<span class="token punctuation">[</span>n<span class="token operator">*</span><span class="token punctuation">(</span>obs_dim<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>n<span class="token operator">*</span><span class="token punctuation">(</span>obs_dim<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    dones<span class="token operator">=</span>data<span class="token punctuation">[</span>n<span class="token operator">*</span><span class="token punctuation">(</span>obs_dim<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>n<span class="token operator">*</span><span class="token punctuation">(</span>obs_dim<span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    logprobs<span class="token operator">=</span>data<span class="token punctuation">[</span>n<span class="token operator">*</span><span class="token punctuation">(</span>obs_dim<span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>n<span class="token operator">*</span><span class="token punctuation">(</span>obs_dim<span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    next_obs<span class="token operator">=</span>data<span class="token punctuation">[</span>n<span class="token operator">*</span><span class="token punctuation">(</span>obs_dim<span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    next_done<span class="token operator">=</span>data<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>
<p><a target="_blank" rel="noopener" href="https://github.com/wty-yy/kaiwu2024_taichu/blob/master/secret_realm/code/conf/configure_app.toml"><code>configure_app.toml</code></a> é…ç½®æ–‡ä»¶åšçš„ä¿®æ”¹å¦‚ä¸‹ï¼ˆå¤§æ¦‚ç‡ä¸æ˜¯æœ€ä¼˜çš„ï¼Œæ²¡æœ‰è¿›è¡Œå¾®è°ƒï¼‰ï¼š</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token comment"># æ³¨: learner_train_by_while_true åœ¨9.2.2æœ€åä¸€æ¬¡æ›´æ–°åå°±åªèƒ½è®¾ç½®ä¸ºTrueæ‰èƒ½ä½¿ç”¨ï¼ˆä¸æ¸…æ¥šä¸ºä»€ä¹ˆï¼Œå•æœºæ¨¡å¼ä¸‹æ²¡æœ‰æµ‹å‡ºé—®é¢˜ï¼‰ï¼Œ</span>
<span class="token comment"># ä¹Ÿå°±æ˜¯åªèƒ½å®šæ—¶è®­ç»ƒï¼Œé‚£ä¹ˆåªèƒ½è‡ªå·±æ‰‹åŠ¨è®¡ç®—ä¸€ä¸ªæ ·æœ¬äº§ç”Ÿæ‰€ç”¨çš„æ—¶é—´ï¼Œ</span>
<span class="token comment"># å†è°ƒæ•´learner_train_sleep_secondsä¸º10ä¸ªæ ·æœ¬ç”Ÿæˆæ‰€éœ€çš„æ—¶é—´ï¼ˆéå¸¸éº»çƒ¦ï¼‰</span>
<span class="token key property">learner_train_by_while_true</span> <span class="token punctuation">=</span> <span class="token boolean">false</span>  <span class="token comment"># å…³äº†è¿™ä¸ªproduction_consume_ratioæ‰æœ‰ç”¨</span>
<span class="token key property">replay_buffer_capacity</span> <span class="token punctuation">=</span> <span class="token number">120</span>  <span class="token comment"># process * 10</span>
<span class="token key property">preload_ratio</span> <span class="token punctuation">=</span> <span class="token number">2</span>  <span class="token comment"># å½“bufferä¸­å­˜åœ¨replay_buffer_capacity/preload_ratioä¸ªæ ·æœ¬æ—¶,å¼€å§‹è®­ç»ƒ,(ä¹Ÿè¦è¦æ±‚learner_train_by_while_true=False)</span>
<span class="token key property">train_batch_size</span> <span class="token punctuation">=</span> <span class="token number">36</span>  <span class="token comment"># learnerè®­ç»ƒæ‰¹å¤„ç†å¤§å°é™åˆ¶, process * 3</span>
<span class="token key property">production_consume_ratio</span> <span class="token punctuation">=</span> <span class="token number">3</span>  <span class="token comment"># æ¶ˆè€—/ç”Ÿæˆæ¯”</span>
<span class="token key property">reverb_sampler</span> <span class="token punctuation">=</span> <span class="token string">"reverb.selectors.Uniform"</span>
<span class="token key property">dump_model_freq</span> <span class="token punctuation">=</span> <span class="token number">2</span>  <span class="token comment"># PPOè¦æ±‚actorå’Œlearneræ¨¡å‹å·®è·ä¸èƒ½å¤ªå¤§, æé«˜åŒæ­¥æ¨¡å‹çš„ä¿å­˜é¢‘ç‡</span>
<span class="token key property">model_file_sync_per_minutes</span> <span class="token punctuation">=</span> <span class="token number">1</span>  <span class="token comment"># è¿™ä¸ªæ˜¯æ¨¡å‹åŒæ­¥åˆ°æ¨¡å‹æ± çš„åŒæ­¥æ—¶é—´ (å•ä½åˆ†é’Ÿ, æœ€å°1min)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>
<p>æœ€åä¸ºäº†é¿å…å­˜å‚¨çš„æ¨¡å‹å¤ªå¤šå¯¼è‡´å†…å­˜çˆ†ç‚¸ï¼Œæˆ‘å†™äº†ä¸ªè‡ªåŠ¨åˆ é™¤æ—§æ¨¡å‹çš„å‡½æ•°ï¼Œåœ¨<a target="_blank" rel="noopener" href="https://github.com/wty-yy/kaiwu2024_taichu/blob/0e620a6d17a92daeb77ed27a2a30cd25672f3e13/secret_realm/code/diy/algorithm/agent.py#L222">learner</a>å’Œ<a target="_blank" rel="noopener" href="https://github.com/wty-yy/kaiwu2024_taichu/blob/4714315cfd8202f38a38772e9e60f4d2b46ceb6b/secret_realm/code/diy/train_workflow.py#L87">aisrv</a>ä¸­å‘¨æœŸæ€§è°ƒç”¨ã€‚</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pathlib <span class="token keyword">import</span> Path
<span class="token keyword">from</span> kaiwudrl<span class="token punctuation">.</span>common<span class="token punctuation">.</span>config<span class="token punctuation">.</span>config_control <span class="token keyword">import</span> CONFIG

<span class="token keyword">def</span> <span class="token function">clean_ckpt_memory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token triple-quoted-string string">"""
  Remove old checkpoints generate by autosave (save frequency=CONFIG.dump_model_freq),
  you can find autosave code at
  `kaiwudrl.common.algorithms.standard_model_wrapper_pytorch.StandardModelWrapperPytorch.after_train()`

  Usage: Call this function in `agent.learn(...)` or `train_workflow.workflow`, 
  recommend in `agent.learn(...)` since it is a single process,
  add small delay as you like~~~
  """</span>
  path_tmp_dir <span class="token operator">=</span> Path<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>CONFIG<span class="token punctuation">.</span>restore_dir<span class="token punctuation">&#125;</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">&#123;</span>CONFIG<span class="token punctuation">.</span>app<span class="token punctuation">&#125;</span></span><span class="token string">_</span><span class="token interpolation"><span class="token punctuation">&#123;</span>CONFIG<span class="token punctuation">.</span>algo<span class="token punctuation">&#125;</span></span><span class="token string">/"</span></span><span class="token punctuation">)</span>
  files <span class="token operator">=</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>path_tmp_dir<span class="token punctuation">.</span>glob<span class="token punctuation">(</span><span class="token string">'model.ckpt-*'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">.</span>rsplit<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>rsplit<span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">:</span> <span class="token keyword">return</span>
  <span class="token keyword">for</span> p <span class="token keyword">in</span> files<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span>  <span class="token comment"># just keep latest checkpoint</span>
    p<span class="token punctuation">.</span>unlink<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>
<p>è¯¦ç»†ä»£ç è¯·è§<a target="_blank" rel="noopener" href="https://github.com/wty-yy/kaiwu2024_taichu/tree/master/secret_realm/code/diy">diy/</a>æ–‡ä»¶å¤¹ï¼ŒPPOç®—æ³•å‚è€ƒçš„æ˜¯<a target="_blank" rel="noopener" href="https://docs.cleanrl.dev/rl-algorithms/ppo/">cleanrl - PPO</a>ã€‚</p>
<h3 id="tensorboardä½¿ç”¨æ–¹æ³•"><a class="markdownIt-Anchor" href="#tensorboardä½¿ç”¨æ–¹æ³•"></a> Tensorboardä½¿ç”¨æ–¹æ³•</h3>
<p>ç”±äºå®åœ¨ä¸ä¹ æƒ¯å®˜æ–¹ç»™çš„è®°å½•è½¯ä»¶ï¼Œè¿˜æ˜¯ç”¨äº†ä¼ ç»Ÿçš„Tensorboardï¼Œæ•ˆæœå›¾å¦‚ä¸‹<br />
<img src="/figures/competitions/kaiwu/tb1.png" srcset="/img/loading.gif" lazyload alt="Tensorboardæ•ˆæœå›¾ï¼ˆä¸Šé¢æ˜¯12ä¸ªç¯å¢ƒæ¯ä¸ªç¯å¢ƒç»“æŸæ—¶è®°å½•çš„ä¿¡æ¯ï¼Œä¸‹é¢ä¸ºlearnerè®­ç»ƒè®°å½•çš„ä¿¡æ¯ï¼‰" /></p>
<p>åœ¨ <code>agent.py</code> é‡Œé¢å®ç°äº†ä¸€ä¸ªä¸‹é¢è¿™ä¸ªåˆå§‹åŒ– <code>writer</code> çš„<a target="_blank" rel="noopener" href="https://github.com/wty-yy/kaiwu2024_taichu/blob/0e620a6d17a92daeb77ed27a2a30cd25672f3e13/secret_realm/code/diy/algorithm/agent.py#L28"><code>init_writer</code> å‡½æ•°</a></p>
<figure><div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os<span class="token punctuation">,</span> time
<span class="token keyword">from</span> pathlib <span class="token keyword">import</span> Path
<span class="token keyword">from</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>tensorboard <span class="token keyword">import</span> SummaryWriter

PATH_ROOT <span class="token operator">=</span> Path<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">.</span>parents<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
PATH_LOGS_DIR <span class="token operator">=</span> PATH_ROOT <span class="token operator">/</span> <span class="token string">"log/tensorboard"</span>
PATH_LOGS_DIR<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>exist_ok<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> parents<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">init_writer</span><span class="token punctuation">(</span>agent_type<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># èµ·ä¸ªåå­—</span>
    run_name <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"secret_realm_</span><span class="token interpolation"><span class="token punctuation">&#123;</span>agent_type<span class="token punctuation">&#125;</span></span><span class="token string">_pid</span><span class="token interpolation"><span class="token punctuation">&#123;</span>os<span class="token punctuation">.</span>getpid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">_</span><span class="token interpolation"><span class="token punctuation">&#123;</span>time<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">r'%Y%m%d_%H%M%S'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>
    writer <span class="token operator">=</span> SummaryWriter<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>PATH_LOGS_DIR <span class="token operator">/</span> run_name<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> writer<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>
<p>ç„¶ååˆ†åˆ«åœ¨learnerå’Œaisrvåˆå§‹åŒ–æ—¶å€™åˆ›å»ºå®ƒï¼Œlearnerä¹Ÿå°±æ˜¯åœ¨<a target="_blank" rel="noopener" href="https://github.com/wty-yy/kaiwu2024_taichu/blob/0e620a6d17a92daeb77ed27a2a30cd25672f3e13/secret_realm/code/diy/algorithm/agent.py#L46">åˆå§‹åŒ– <code>Agent</code></a>æ—¶å€™ï¼Œaisrvä¹Ÿå°±æ˜¯åœ¨<a target="_blank" rel="noopener" href="https://github.com/wty-yy/kaiwu2024_taichu/blob/0e620a6d17a92daeb77ed27a2a30cd25672f3e13/secret_realm/code/diy/train_workflow.py#L22">åˆšè¿›å…¥<code>train_workflow.py</code>æ—¶å€™</a>ï¼ˆè¿™é‡Œä¸è¦åœ¨Agentä¸­åˆå§‹åŒ–åŸå› æ˜¯, æ‰€æœ‰çš„aisrvå…¶å®å…¬ç”¨çš„åŒä¸€ä¸ªAgentå®ä¾‹åŒ–ç»“æœ, æ‰€ä»¥ä»–åªä¼šè¢«åˆ›å»ºä¸€æ¬¡ï¼‰</p>
<p>ç„¶åå°±å’Œæ­£å¸¸ä½¿ç”¨tensorboardä¸€æ ·è®°å½•å°±å¥½äº†, æ¯”å¦‚åœ¨<a target="_blank" rel="noopener" href="https://github.com/wty-yy/kaiwu2024_taichu/blob/0e620a6d17a92daeb77ed27a2a30cd25672f3e13/secret_realm/code/diy/train_workflow.py#L49">ç¯å¢ƒç»“æŸ</a>æ—¶ï¼š</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">if</span> env<span class="token punctuation">.</span>done<span class="token punctuation">:</span>
  logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"pid=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>os<span class="token punctuation">.</span>getpid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string"> End episode: gloabl_step=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>global_step<span class="token punctuation">&#125;</span></span><span class="token string">, episodic_reward=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>env<span class="token punctuation">.</span>total_reward<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">&#125;</span></span><span class="token string">, "</span></span> <span class="token operator">+</span>
           <span class="token string-interpolation"><span class="token string">f"episodic_score=</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">int</span><span class="token punctuation">(</span>env<span class="token punctuation">.</span>total_score<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">, "</span></span> <span class="token operator">+</span>
           <span class="token string-interpolation"><span class="token string">f"miss_treasure=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>env<span class="token punctuation">.</span>miss_treasure<span class="token punctuation">&#125;</span></span><span class="token string">, n_treasure=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>env<span class="token punctuation">.</span>n_treasure<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
  writer<span class="token punctuation">.</span>add_scalar<span class="token punctuation">(</span><span class="token string">"charts/episodic_reward"</span><span class="token punctuation">,</span> env<span class="token punctuation">.</span>total_reward<span class="token punctuation">,</span> global_step<span class="token punctuation">)</span>
  writer<span class="token punctuation">.</span>add_scalar<span class="token punctuation">(</span><span class="token string">"charts/episodic_score"</span><span class="token punctuation">,</span> env<span class="token punctuation">.</span>total_score<span class="token punctuation">,</span> global_step<span class="token punctuation">)</span>
  writer<span class="token punctuation">.</span>add_scalar<span class="token punctuation">(</span><span class="token string">"charts/episodic_length"</span><span class="token punctuation">,</span> env<span class="token punctuation">.</span>n_step<span class="token punctuation">,</span> global_step<span class="token punctuation">)</span>
  writer<span class="token punctuation">.</span>add_scalar<span class="token punctuation">(</span><span class="token string">"charts/hit_wall"</span><span class="token punctuation">,</span> env<span class="token punctuation">.</span>total_hit_wall<span class="token punctuation">,</span> global_step<span class="token punctuation">)</span>
  writer<span class="token punctuation">.</span>add_scalar<span class="token punctuation">(</span><span class="token string">"charts/miss_treasure"</span><span class="token punctuation">,</span> env<span class="token punctuation">.</span>miss_treasure<span class="token punctuation">,</span> global_step<span class="token punctuation">)</span>
  writer<span class="token punctuation">.</span>add_scalar<span class="token punctuation">(</span><span class="token string">"charts/n_treasure"</span><span class="token punctuation">,</span> env<span class="token punctuation">.</span>n_treasure<span class="token punctuation">,</span> global_step<span class="token punctuation">)</span>
  writer<span class="token punctuation">.</span>add_scalar<span class="token punctuation">(</span><span class="token string">"charts/total_flash"</span><span class="token punctuation">,</span> env<span class="token punctuation">.</span>total_flash<span class="token punctuation">,</span> global_step<span class="token punctuation">)</span>
  writer<span class="token punctuation">.</span>add_scalar<span class="token punctuation">(</span><span class="token string">"charts/miss_buffer"</span><span class="token punctuation">,</span> env<span class="token punctuation">.</span>miss_buffer<span class="token punctuation">,</span> global_step<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>
<p><strong>å¯åŠ¨æ–¹æ³•</strong>ï¼š</p>
<ul>
<li>å¦‚æœæ˜¯ä»å®¢æˆ·ç«¯å¯åŠ¨è®­ç»ƒï¼Œç›´æ¥é€šè¿‡ <code>tensorboard --logdir [ä½ çš„å·¥ä½œè·¯å¾„]\train\log\tensorboard</code> å°±å¯ä»¥å®æ—¶çœ‹è®­ç»ƒæ›²çº¿äº†ã€‚</li>
<li>å¦‚æœæ˜¯ä»ç›´æ¥è¿è¡Œçš„ <code>train_test.py</code> é‚£å°±ç›´æ¥åœ¨ <code>[ä½ çš„å·¥ä½œè·¯å¾„]\code\log\tensorboard</code> ä¸‹æ‰“å¼€å°±è¡Œäº†.</li>
</ul>
<h3 id="ç½‘ç»œç»“æ„ä¸ç‰¹å¾è®¾è®¡"><a class="markdownIt-Anchor" href="#ç½‘ç»œç»“æ„ä¸ç‰¹å¾è®¾è®¡"></a> ç½‘ç»œç»“æ„ä¸ç‰¹å¾è®¾è®¡</h3>
<blockquote>
<p>ç”±äºæ²¡æœ‰ä½¿ç”¨å®˜æ–¹ç»™çš„dqnï¼Œè¿™éƒ¨åˆ†ä¹Ÿé¡ºä¾¿å…¨éƒ¨é‡å†™äº†ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬è®¾è®¡çš„ç½‘ç»œæä¸ºç®€å•ï¼šçº¯CNN+æ‹¼æ¥+MLPï¼ˆä¸èƒ½åœ¨ç®€å•äº†å§ğŸ˜‚ï¼‰ï¼Œä»£ç ä¸º<a target="_blank" rel="noopener" href="https://github.com/wty-yy/kaiwu2024_taichu/blob/master/secret_realm/code/diy/algorithm/model.py">model.py</a></p>
<figure><div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Backbone</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>cnn <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>
      nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> kernel_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      nn<span class="token punctuation">.</span>Flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">4096</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>fc <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>
      nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">512</span><span class="token operator">+</span>args<span class="token punctuation">.</span>observation_vec_shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    self<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>layer_init<span class="token punctuation">)</span>

  <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    obs_size <span class="token operator">=</span> np<span class="token punctuation">.</span>prod<span class="token punctuation">(</span>args<span class="token punctuation">.</span>observation_img_shape<span class="token punctuation">)</span>
    B <span class="token operator">=</span> x<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    img<span class="token punctuation">,</span> vec <span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span>obs_size<span class="token punctuation">]</span><span class="token punctuation">,</span> x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> obs_size<span class="token punctuation">:</span><span class="token punctuation">]</span>
    img <span class="token operator">=</span> img<span class="token punctuation">.</span>view<span class="token punctuation">(</span>B<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">.</span>observation_img_shape<span class="token punctuation">)</span>
    x <span class="token operator">=</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token punctuation">[</span>self<span class="token punctuation">.</span>cnn<span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">,</span> vec<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> self<span class="token punctuation">.</span>fc<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>
<p>è¾“å…¥çš„ç‰¹å¾å¤„ç†å‡½æ•°ä¸º<a target="_blank" rel="noopener" href="https://github.com/wty-yy/kaiwu2024_taichu/blob/0e620a6d17a92daeb77ed27a2a30cd25672f3e13/secret_realm/code/diy/feature/definition.py#L286">definition.observation_process</a>ï¼š</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python">feature <span class="token operator">=</span> np<span class="token punctuation">.</span>hstack<span class="token punctuation">(</span><span class="token punctuation">[</span>
  np<span class="token punctuation">.</span>stack<span class="token punctuation">(</span><span class="token punctuation">[</span>  <span class="token comment"># å›¾åƒç‰¹å¾: (4, 51, 51)</span>
    obs<span class="token punctuation">[</span><span class="token string">'obstacle_map'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    obs<span class="token punctuation">[</span><span class="token string">'memory_map'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    obs<span class="token punctuation">[</span><span class="token string">'treasure_map'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    obs<span class="token punctuation">[</span><span class="token string">'end_map'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment"># çº¿æ€§ç‰¹å¾: (31,)</span>
  <span class="token operator">*</span>obs<span class="token punctuation">[</span><span class="token string">'norm_pos'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token operator">*</span>obs<span class="token punctuation">[</span><span class="token string">'treasure_flags'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token operator">*</span>obs<span class="token punctuation">[</span><span class="token string">'treasure_grid_distance'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  obs<span class="token punctuation">[</span><span class="token string">'buff_flag'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  obs<span class="token punctuation">[</span><span class="token string">'buff_pos'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'grid_distance'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  obs<span class="token punctuation">[</span><span class="token string">'end_pos'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'grid_distance'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment"># é—ªç°æ˜¯å¦å¯ç”¨: (1,)</span>
  <span class="token comment"># è¿™ä¸ªmaskä¸æ˜¯æ¨¡å‹çš„è¾“å…¥ï¼Œåªæ˜¯ä¸€åŒå­˜å‚¨åˆ°obsä¸­ï¼Œéœ€è¦æ‰‹åŠ¨åˆ†ç¦»å‡ºæ¥</span>
  obs<span class="token punctuation">[</span><span class="token string">'legal_act'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>
<h3 id="å¥–åŠ±å‡½æ•°è®¾è®¡"><a class="markdownIt-Anchor" href="#å¥–åŠ±å‡½æ•°è®¾è®¡"></a> å¥–åŠ±å‡½æ•°è®¾è®¡</h3>
<p>è¿™ä¸ªå¥–åŠ±å‡½æ•°æˆ‘ä»¬å¤§éƒ¨åˆ†æ˜¯ç›´æ¥æ²¿ç”¨äº†å­¦ä¹ æœŸçš„è®¾è®¡ï¼Œä»<a target="_blank" rel="noopener" href="https://github.com/wty-yy/kaiwu2024_taichu/blob/0e620a6d17a92daeb77ed27a2a30cd25672f3e13/secret_realm/code/diy/feature/definition.py#L116"><code>definition.py</code></a>ä¸­å°±èƒ½çœ‹åˆ°æˆ‘ä»¬è®¾è®¡çš„å¥–åŠ±å‡½æ•°ï¼Œç›¸åº”çš„é…ç½®æ–‡ä»¶ä½äº<a target="_blank" rel="noopener" href="https://github.com/wty-yy/kaiwu2024_taichu/blob/master/secret_realm/code/diy/config.py">config.pyçš„Args</a>ä¸­ï¼š</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-python" data-language="python"><code class="language-python">r <span class="token operator">=</span> <span class="token number">0</span>
<span class="token comment"># 1. é‡å¤æ­¥éª¤æƒ©ç½šï¼Œå½“ä¸€ä¸ªä½ç½®é‡å¤èµ°è¿‡2æ¬¡ä»¥ä¸Š</span>
ratio <span class="token operator">=</span> self<span class="token punctuation">.</span>total_timestep <span class="token operator">*</span> args<span class="token punctuation">.</span>num_envs <span class="token operator">/</span> args<span class="token punctuation">.</span>total_timesteps
<span class="token keyword">if</span> ratio <span class="token operator">&lt;</span> <span class="token number">0.5</span><span class="token punctuation">:</span>  <span class="token comment"># å‰ä¸€åŠçš„æ—¶å€™è€ƒè™‘å½“å‰ä½ç½®çš„æƒ©ç½š</span>
  r <span class="token operator">-=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>obs<span class="token punctuation">[</span><span class="token string">'memory_map'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">25</span><span class="token punctuation">,</span><span class="token number">25</span><span class="token punctuation">]</span> <span class="token operator">-</span> args<span class="token punctuation">.</span>repeat_step_thre<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token comment"># assert obs['memory_map'][25,25] > 0  # won't be > 0</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>  <span class="token comment"># åä¸€åŠçš„æ—¶å€™è€ƒè™‘å‘¨å›´5x5ä½ç½®çš„åŠ æƒæƒ©ç½š</span>
  r <span class="token operator">-=</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>repeat_punish <span class="token operator">*</span> np<span class="token punctuation">.</span>maximum<span class="token punctuation">(</span>
    obs<span class="token punctuation">[</span><span class="token string">'memory_map'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">:</span><span class="token number">28</span><span class="token punctuation">,</span><span class="token number">23</span><span class="token punctuation">:</span><span class="token number">28</span><span class="token punctuation">]</span><span class="token operator">-</span>args<span class="token punctuation">.</span>repeat_step_thre<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 2. åˆ°ç›®æ ‡ç‚¹ï¼ˆè¿™æ˜¯è®¾è®¡çš„æœ€å¤§é—®é¢˜ï¼Œå­¦ä¹ åˆ«äººçš„å¥–åŠ±å‡½æ•°æ—¶ï¼Œå‘ç°å¯ä»¥å½“å®ç®±æ²¡æœ‰æ”¶é›†å®Œæ—¶ä¸ç»™è¿™ä¸ªå¥–åŠ±ï¼‰</span>
<span class="token comment"># ï¼ˆè¿™æ ·ç›´æ¥è®¾è®¡å¥–åŠ±ï¼Œå¯èƒ½è®©æ¨¡å‹ä¸¢å¤±éƒ¨åˆ†å®ç®±ï¼‰</span>
<span class="token keyword">if</span> terminated<span class="token punctuation">:</span>
  r <span class="token operator">+=</span> <span class="token number">150</span>
  <span class="token comment"># å¯¹æœªæ¡åˆ°çš„å®ç®±åšåŠ æƒæƒ©ç½šï¼ŒåŠ æƒç³»æ•°ä¸å†å²ä¸­æœªæ¡åˆ°è¯¥å®ç®±æ¬¡æ•°æˆæ­£æ¯”</span>
  r <span class="token operator">-=</span> <span class="token punctuation">(</span>obs<span class="token punctuation">[</span><span class="token string">'treasure_flags'</span><span class="token punctuation">]</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>treasure_reward_coef<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span>
  <span class="token comment"># å¯¹æœªæ¡åˆ°çš„buffè¿›è¡Œæƒ©ç½š</span>
  r <span class="token operator">-=</span> obs<span class="token punctuation">[</span><span class="token string">'buff_flag'</span><span class="token punctuation">]</span> <span class="token operator">*</span> args<span class="token punctuation">.</span>forget_buff_punish
  self<span class="token punctuation">.</span>treasure_miss_cnt <span class="token operator">+=</span> obs<span class="token punctuation">[</span><span class="token string">'treasure_flags'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>int32<span class="token punctuation">)</span>
<span class="token comment"># ç§»åŠ¨ç³»æ•°è®¡ç®—ï¼Œå¦‚æœæ˜¯ä½¿ç”¨é—ªç°åˆ™ä¼šç”¨æ›´å¤§çš„ç³»æ•°</span>
dist_reward_coef <span class="token operator">=</span> args<span class="token punctuation">.</span>flash_dist_reward_coef <span class="token keyword">if</span> self<span class="token punctuation">.</span>use_flash <span class="token keyword">else</span> args<span class="token punctuation">.</span>dist_reward_coef
<span class="token comment"># åˆ°è¾¾ç»ˆç‚¹çš„ç›¸å¯¹è·ç¦»</span>
delta_end_distance <span class="token operator">=</span> self<span class="token punctuation">.</span>_obs<span class="token punctuation">[</span><span class="token string">'end_pos'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'grid_distance'</span><span class="token punctuation">]</span> <span class="token operator">-</span> obs<span class="token punctuation">[</span><span class="token string">'end_pos'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'grid_distance'</span><span class="token punctuation">]</span>
r <span class="token operator">+=</span> delta_end_distance <span class="token operator">*</span> dist_reward_coef
<span class="token comment"># 3. åˆ°å®ç®±</span>
<span class="token keyword">if</span> <span class="token keyword">not</span> terminated <span class="token keyword">and</span> score <span class="token operator">==</span> <span class="token number">100</span><span class="token punctuation">:</span>  <span class="token comment"># è·å¾—å®ç®±çš„å¥–åŠ±</span>
  r <span class="token operator">+=</span> <span class="token number">100</span> <span class="token operator">*</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>treasure_reward_coef <span class="token operator">*</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>_obs<span class="token punctuation">[</span><span class="token string">'treasure_flags'</span><span class="token punctuation">]</span> <span class="token operator">^</span> obs<span class="token punctuation">[</span><span class="token string">'treasure_flags'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_obs<span class="token punctuation">[</span><span class="token string">'treasure_flags'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># ä¸æœ€è¿‘çš„å®ç®±è·ç¦»</span>
  dist_treasure <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_obs<span class="token punctuation">[</span><span class="token string">'treasure_grid_distance'</span><span class="token punctuation">]</span> <span class="token operator">-</span>
                          self<span class="token punctuation">.</span>obs<span class="token punctuation">[</span><span class="token string">'treasure_grid_distance'</span><span class="token punctuation">]</span>
                        <span class="token punctuation">)</span><span class="token punctuation">[</span>self<span class="token punctuation">.</span>_obs<span class="token punctuation">[</span><span class="token string">'treasure_flags'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  r <span class="token operator">+=</span> dist_treasure <span class="token operator">*</span> dist_reward_coef
<span class="token comment"># 4. æ’å¢™æƒ©ç½š</span>
<span class="token keyword">if</span> hit_wall<span class="token punctuation">:</span>
  r <span class="token operator">-=</span> args<span class="token punctuation">.</span>flash_hit_wall_punish <span class="token keyword">if</span> self<span class="token punctuation">.</span>use_flash <span class="token keyword">else</span> args<span class="token punctuation">.</span>walk_hit_wall_punish
<span class="token comment"># 5. buffå¥–åŠ±</span>
<span class="token keyword">if</span> self<span class="token punctuation">.</span>_obs<span class="token punctuation">[</span><span class="token string">'buff_flag'</span><span class="token punctuation">]</span> <span class="token operator">-</span> obs<span class="token punctuation">[</span><span class="token string">'buff_flag'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
  r <span class="token operator">+=</span> args<span class="token punctuation">.</span>get_buff_reward
<span class="token comment"># 6. æ¯æ­¥çš„æƒ©ç½šï¼Œå¦‚æœæ˜¯åˆæ¬¡è®­ç»ƒåˆ™ååŠç¨‹æ‰åŠ å…¥ï¼Œå¦‚æœæ˜¯æ¥ç€è®­ç»ƒåˆ™ä¸€ç›´å­˜åœ¨</span>
<span class="token keyword">if</span> ratio <span class="token operator">></span> <span class="token number">0.5</span> <span class="token keyword">or</span> args<span class="token punctuation">.</span>load_model_id <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
  r <span class="token operator">-=</span> args<span class="token punctuation">.</span>each_step_punish
<span class="token comment"># 7. å…¨å±€å¥–åŠ±åŠ æƒç³»æ•°ï¼ˆç”±äºå¥–åŠ±å¤ªå¤§ï¼Œå…¨éƒ¨ç¼©å°çš„0.1å€ï¼‰</span>
r <span class="token operator">*=</span> args<span class="token punctuation">.</span>reward_global_coef<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>
<p>æˆ‘ä»¬çš„ç‰ˆæœ¬è¿­ä»£æ—¥å¿—ä¸»è¦ä¸º <code>v0.4.3 -&gt; v1.0 -&gt; v1.1 -&gt; v1.2 -&gt; v1.2.x</code>ï¼Œæœ€åæäº¤çš„æ˜¯v1.2ï¼Œæ—¥å¿—æ–‡ä»¶å¯ä»¥åœ¨<a target="_blank" rel="noopener" href="https://github.com/wty-yy/kaiwu2024_taichu/tree/master/secret_realm/code#2024813">code/readme.md</a>ä¸­æ‰¾åˆ°ã€‚</p>
<h3 id="é˜¶æ®µæ€»ç»“"><a class="markdownIt-Anchor" href="#é˜¶æ®µæ€»ç»“"></a> é˜¶æ®µæ€»ç»“</h3>
<p>è¿™æ¬¡æ”¾å¤ªå¤šæ³¨æ„åŠ›åœ¨ç†è§£åˆ†å¸ƒå¼æ¡†æ¶å’Œå®ç°PPOç®—æ³•ä¸Šäº†ï¼Œä¸­é—´PPOç®—æ³•å®ç°é‡åˆ°äº†å¾ˆå¤šbugï¼Œæœ€åä¹Ÿæ˜¯æ²¡æœ‰å¯¹å¥–åŠ±å†è¿›è¡Œå¾®è°ƒï¼Œæ²¡æœ‰åœ¨æ‰€æœ‰å®ç®±ä½ç½®ä¸Šå¯¹æ¨¡å‹è¿›è¡Œæµ‹è¯•ï¼Œæ‰å¯¼è‡´å‡ºç°æ¼æ‰å®ç®±çš„é—®é¢˜ï¼Œä¸‹æ¬¡è¦å°†æ³¨æ„åŠ›æ›´å¤šé›†ä¸­åœ¨<strong>ç¯å¢ƒè°ƒè¯•ï¼Œç½‘ç»œè®¾è®¡ï¼Œå‚æ•°å¾®è°ƒï¼Œå¥–åŠ±è®¾è®¡</strong>ä¸Šã€‚</p>
<p>è¿™æ¬¡å­¦ä¹ äº†å¼€æ‚Ÿçš„åˆ†å¸ƒå¼æ¡†æ¶åŸç†ä¹Ÿæ˜¯ä¸€å¤§æ”¶è·ï¼Œåé¢ä¼°è®¡æˆ‘è‡ªå·±ä¹Ÿå¯ä»¥ç…§æ ·å­è®¾è®¡ä¸€ä¸ªï¼Œç”¨äºä¹‹å‰æ¯•è®¾æœªå®Œæˆçš„çœŸæ­£å¼ºåŒ–å­¦ä¹ AIè®­ç»ƒï¼ˆå½“ç„¶ç°åœ¨ç¡¬ä»¶è¿˜æ˜¯ä¸å¤Ÿï¼‰ã€‚</p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>
                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/coding/" class="category-chain-item">coding</a>
  
  
    <span>></span>
    
  <a href="/categories/coding/%E6%AF%94%E8%B5%9B/" class="category-chain-item">æ¯”èµ›</a>
  
  

  

      </span>
    
  
</span>

    </div>
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>2024å¼€æ‚Ÿæ™ºèƒ½ä½“æ¯”èµ›ï¼ˆæµ·é€‰èµ›ï¼‰</div>
      <div>https://wty-yy.xyz/posts/33143/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>ä½œè€…</div>
          <div>wty</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>å‘å¸ƒäº</div>
          <div>2024å¹´9æœˆ3æ—¥</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>è®¸å¯åè®®</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - ç½²å">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/posts/48556/" title="é€»è¾‘åˆ†æä»ªLA1010ç¬”è®°">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">é€»è¾‘åˆ†æä»ªLA1010ç¬”è®°</span>
                        <span class="visible-mobile">ä¸Šä¸€ç¯‡</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/posts/10130/" title="F28069Må¼€å‘æ¿ç¬”è®°">
                        <span class="hidden-mobile">F28069Må¼€å‘æ¿ç¬”è®°</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.4.16/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"7JWUOvcOubbTCSI8jHpuVSJ0-gzGzoHsz","appKey":"98rYU3iGXuuKPVyUjNYHGpr9","path":"window.location.pathname","placeholder":"è¯´ç‚¹ä»€ä¹ˆ","avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":true,"recordIP":true,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":false},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>ç›®å½•</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  


  
  








    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> <br> Enjoy sharing! <br> <span id="runtime_span"></span> <script type="text/javascript">function show_runtime(){window.setTimeout("show_runtime()",1000);X=new Date("3/19/2021 00:00:00");Y=new Date();T=(Y.getTime()-X.getTime());M=24*60*60*1000;a=T/M;A=Math.floor(a);b=(a-A)*24;B=Math.floor(b);c=(b-B)*60;C=Math.floor((b-B)*60);D=Math.floor((c-C)*60);runtime_span.innerHTML="å°ç«™å·²è¿è¡Œ"+A+"å¤©"+B+"å°æ—¶"+C+"åˆ†"+D+"ç§’"}show_runtime();</script> 
    </div>
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.0/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script  src="https://lib.baomitu.com/prism/1.26.0/plugins/line-numbers/prism-line-numbers.min.js" ></script>

  <script src=https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>




  
<script src="//fastly.jsdelivr.net/gh/bynotes/texiao/source/js/caidai.js"></script>



<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ï¼Œå°†å®ƒä¿æŒåœ¨æœ€åº•éƒ¨ -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">åšå®¢åœ¨å…è®¸ JavaScript è¿è¡Œçš„ç¯å¢ƒä¸‹æµè§ˆæ•ˆæœæ›´ä½³</div>
  </noscript>
</body>
</html>
